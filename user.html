<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>My Account</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="./config.js"></script>
  </head>

  <body class="min-h-screen bg-gray-100 flex items-center justify-center px-4">
    <div class="w-full max-w-md bg-white rounded-xl shadow-lg p-6">
      <h2 class="text-2xl font-bold text-center mb-6">My Account</h2>
      <div class="space-y-3 text-sm">
        <div class="flex justify-between">
          <span class="font-medium text-gray-600">Username:</span>
          <span id="username"></span>
        </div>
        <div class="flex justify-between">
          <span class="font-medium text-gray-600">Email:</span>
          <span id="email"></span>
        </div>
        <div class="flex justify-between">
          <span class="font-medium text-gray-600">Role:</span>
          <span id="role"></span>
        </div>
      </div>
      <div class="mt-8 space-y-3">
        <button
          onclick="logout()"
          class="w-full bg-gray-600 text-white py-2 rounded hover:bg-gray-700"
        >
          Logout
        </button>
        <button
          onclick="deleteAccount()"
          class="w-full bg-red-600 text-white py-2 rounded hover:bg-red-700"
        >
          Delete Account
        </button>
      </div>
    </div>
    <script>
      const isLogin = localStorage.getItem("token");
      const user = JSON.parse(localStorage.getItem("user"));
      console.log("useruser", user);
      if (!isLogin) {
        window.location.href = "login.html";
      }

      document.getElementById("username").innerText = user.username;
      document.getElementById("email").innerText = user.email;
      document.getElementById("role").innerText = user.role;

      function logout() {
        localStorage.removeItem("user");
        window.location.href = "login.html";
      }

      async function deleteAccount() {
        const confirmDelete = confirm(
          "Are you sure you want to delete your account? This action cannot be undone."
        );

        if (!confirmDelete) return;
        const getToken = localStorage.getItem("token");

        try {
          const response = await fetch(
            `${window.ENV.API_URL}/api/auth/delete-google-console-user/${user.id}`,
            {
              method: "DELETE",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${getToken}`,
              },
            }
          );

          const data = await response.json();
          if (response.status === 200) {
            alert("Account deleted successfully");
            localStorage.removeItem("token");
            window.location.href = "register.html";
          } else {
            alert(data.message || "Failed to delete account");
          }
        } catch (error) {
          alert("Server error");
        }
      }
    </script>
  </body>
</html>
